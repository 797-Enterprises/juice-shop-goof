name: Snyk SBOM Generation

on:
  workflow_dispatch:
  workflow_call:

jobs:
  sbom-open-source:
    runs-on: ubuntu-latest
    steps:
        - uses: actions/checkout@master
        - name: Use Node.js
          uses: actions/setup-node@v3
          with:
            node-version: 18.4
        - uses: snyk/actions/setup@master
        - name: Snyk SBOM Generate
          run: snyk sbom --all-projects --exclude=build --format=cyclonedx1.4+json --json-file-output=sbom-cyclonedx.json # Exclude the 'build' directory
          env:
            SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        - name: 'Upload SBOM'
          uses: actions/upload-artifact@v3
          with:
            name: sbom-cyclonedx
            path: sbom-cyclonedx.json
            retention-days: 5